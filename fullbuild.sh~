

# BUILD SCRIPT

 #Build script to apply all patches for galaxy grand duos

 #Copyright (c) 2014 Rutvik Rajagopal

 #This program is free software: you can redistribute it and/or modify
 #it under the terms of the GNU General Public License as published by
 #the Free Software Foundation, either version 3 of the License, or
 #(at your option) any later version.

 #This program is distributed in the hope that it will be useful,
 #but WITHOUT ANY WARRANTY; without even the implied warranty of
 #MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 #GNU General Public License for more details.

 #You should have received a copy of the GNU General Public License
 #along with this program. If not, see <http://www.gnu.org/licenses/>.

#! /bin/sh
#this script copies the patches from the patch folder to the rom folder 
# just replace the ~/patch to ur folder name where the patches exist and change ~/cm11 to the path of the rom 



#these copy normal patches reqd to boot the device and core functions to work
cp -r ~/patch/audiovideo.diff ~/cm11/frameworks/av
cp -r ~/patch/bluetooth.diff ~/cm11/hardware/broadcom/libbt
cp -r ~/patch/hwc.diff ~/cm11/frameworks/native
cp -r ~/patch/webview.diff ~/cm11/external/chromium_org
cp -r ~/patch/ril.diff ~/cm11/system/core



echo -e " patches copied ... pleaser review to check for any errors "
read -p " PRESS ENTER TO START APPLYING THE PATCHES "

echo -e ""
echo -e " Applying Patches for Galaxy Grand Duos "
echo -e ""

# Bluetooth Patch
echo -e ""
echo -e " APPLYING BLUETOOTH PATCH "
echo -e ""
cd hardware/broadcom/libbt
git checkout .
patch -p1 < bluetooth.diff
cd ../../../
echo -e " BLUETOOTH PATCH APPLIED SUCCESSFULLY "
echo -e ""

# HW Composer Patch 
echo -e ""
echo -e " APPLYING HWC PATCH "
cd frameworks/native
git checkout .
patch -p1 < hwc.diff
git fetch http://review.cyanogenmod.org/CyanogenMod/android_frameworks_native refs/changes/62/53162/6 && git format-patch -1 --stdout FETCH_HEAD

echo -e ""
echo -e " HWC PATCHES APPLIED SUCCESSFULLY"
echo -e ""

# AUDIO/VIDEO PATCHES 
echo -e ""
echo -e " APPLYING A/V PATCHES"
echo -e ""
cd ../av
git checkout .
patch -p1 < audiovideo.diff 
echo -e ""
echo -e " AUDIO/VIDEO PATCHES APPLIED SUCCESSFULLY "

# WEBVIEW PATCHES 
echo -e ""
echo -e " APPLYING WEBVIEW PATCH "
echo -e ""
cd ../../
cd external/chromium_org
git checkout .
patch -p1 < webview.diff
echo -e ""
echo -e " WEBVIEW PATCHES APPLIED SUCCESSFULLY"

# ACTUAL BUILD 
echo -e ""
echo -e " ALL PATCHES APPLIED SUCCESSFULLY AND NOW BUILD STARTING "
echo -e ""
cd ../../

#checking if msim exists

if [ -d "frameworks/opt/telephony-msim" ]
then
    echo "MSIM SUPPORTED ."
   
#now copying msim patches ... change the path cm11 to any other rom you are compiling

cp -r ~/patch/msim/msim_frameworks_base.diff ~/cm11/frameworks/base
cp -r ~/patch/msim/msim_frameworks_opt_telephony-msim.patch ~/cm11/frameworks/opt/telephony-msim
cp -r ~/patch/msim/msim_packages_apps_Setting.diff ~/cm11/packages/apps/Settings
cp -r ~/patch/msim/msim_packages_services_Telephony.diff ~/cm11/packages/services/Telephony

echo -e ""
echo -e "MSIM PATCHES COPIED ! PLEASE REVIEW FOR ANY ERRORS"
read -p "PRESS ENTER TO APPLY PATCHES"


#frameworks/base patch 
echo -e " PATCHING FRAMEWORKS/BASE "
echo -e ""

cd frameworks/base 
git checkout .
patch -p1 < msim_frameworks_base.diff
rm -rf packages/SystemUI/res/layout/status_bar_expanded.xml.orig

echo -e " frameworks/base patched successfully "
echo -e ""

# applying frameworks/opt/telephony-msim patch 
echo -e " applying  telephony-msim patch"
echo -e ""
cd ../opt/telephony-msim
git checkout .
patch -p1 < msim_frameworks_opt_telephony-msim.patch

echo -e " telephony-msim patched successfully"
echo -e ""

echo -e " applying opt/telephony patch "

cd ../telephony
git checkout .
patch -p1 < msim_frameworks_opt_telephony.patch

echo -e "telephony patched successfully!!"


# applying settings patch 

echo -e " applying settings patch "
echo -e ""
cd ../../../
cd packages/apps/Settings
git checkout .
patch -p1 < msim_packages_apps_Setting.diff
echo -e ""
echo -e " settings patch applied successfully"
echo -e ""

cd ../../../

echo -e ""
echo -e " all msim patches applied ..pl review fr any errors "
read -p " PRESS ENTER TO START BUILDING "

. build/envsetup.sh && brunch i9082 -j4
    
else
    echo "MSIM NOT SUPPORTED."
    read -p " PRESS ENTER TO START THE BUILD"
. build/envsetup.sh && brunch i9082
 
fi



 
